import io

import pytest

from zimscan import Reader


# https://wiki.openzim.org/wiki/ZIM_File_Example
ZIM_EXAMPLE = b"ZIM\x04\x05\x00\x00\x00\x19\xfd\x91\x00s+\xcf\xb64\x06U\x19\xac.\x03\xc4\x03\x00\x00\x00\x01\x00\x00\x00f\x00\x00\x00\x00\x00\x00\x00~\x00\x00\x00\x00\x00\x00\x00\xce\x00\x00\x00\x00\x00\x00\x00P\x00\x00\x00\x00\x00\x00\x00\xff\xff\xff\xff\xff\xff\xff\xff'\x01\x00\x00\x00\x00\x00\x00text/html\x00text/plain\x00\x00\x8a\x00\x00\x00\x00\x00\x00\x00\xa0\x00\x00\x00\x00\x00\x00\x00\xb8\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00\x02\x00\x00\x00\x00\x00\x00A\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00Auto\x00\x00\xff\xff\x00A\x00\x00\x00\x00\x00\x00\x00\x00Automobile\x00\x00\x01\x00\x00B\x00\x00\x00\x00\x00\x00\x00\x00\x01\x00\x00\x00Auto\x00\x00\xd6\x00\x00\x00\x00\x00\x00\x00\x04\xfd7zXZ\x00\x00\x01i\"\xde6\x02\x00!\x01\x10\x00\x00\x00\xa8p\x8e\x86\xe0\x00\x1c\x00\x18^\x00\x06\x004\xfb\xde\x91r\xa3\x804\xfc1\x87\x1f\xe6\xaaa\x04p%\xb1\x84\xdc\x00\x00\xe1f\xf9\xe7\x00\x010\x1d\x01\xef\xc6\x9c\x90B\x99\r\x01\x00\x00\x00\x00\x01YZl\xd7]\xbex\x95<y\xd9PT\x03KW&\xc4"


def test_example():

    file = io.BytesIO(ZIM_EXAMPLE)
    reader = Reader(file)
    iterator = iter(reader)

    record = next(iterator)
    assert record.read() == b"<h1>Auto</h1>"

    record = next(iterator)
    assert record.read() == b"Auto"

    with pytest.raises(StopIteration):
        next(iterator)
